<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tisk fotografií</title>

<link rel="stylesheet" href="style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
main { padding: 40px; }
.order-row { display:flex; gap:10px; margin-bottom:10px; flex-wrap:wrap; }
.order-row input, .order-row select { padding:6px; }
button { padding:8px 14px; margin-top:10px; }
#confirmation { display:none; margin-top:40px; }
</style>
</head>

<body>

<div class="container">

<!-- SIDEBAR -->
<aside class="sidebar">
  <div class="logo">
    <a href="index.html"><img src="img/logo.webp"></a>
  </div>
  <ul>
    <li><a href="index.html">Úvod</a></li>
    <li><a href="tisk.html">Tisk</a></li>
  </ul>
</aside>

<main class="content">

<h1>Tisk fotografií</h1>

<form name="tisk" method="POST" netlify onsubmit="handleSubmit(event)">

<input type="hidden" name="form-name" value="tisk">

<!-- Hidden fields pro Netlify -->
<input type="hidden" name="order_number" id="order_number">
<input type="hidden" name="order_items" id="order_items">
<input type="hidden" name="order_total" id="order_total">

<div id="items">

<div class="order-row">
  <input type="text" placeholder="Číslo fotografie" class="photo">
  <select class="format">
    <option value="A4">A4 (150 Kč)</option>
    <option value="A3">A3 (250 Kč)</option>
  </select>
  <select class="count">
    <option>1</option><option>2</option><option>3</option>
    <option>4</option><option>5</option><option>6</option>
    <option>7</option><option>8</option><option>9</option>
    <option>10</option>
  </select>
</div>

</div>

<button type="button" onclick="addItem()">Přidat položku</button>

<hr>

<textarea name="note" placeholder="Poznámka" style="width:100%;height:80px;"></textarea>
<label style="display:flex; gap:8px; align-items:center;">
  <input type="checkbox" name="gdpr" value="souhlas" required>
  Souhlasím se zpracováním osobních údajů pro účely vyřízení objednávky
</label>

<br><br>
<button type="submit">Odeslat objednávku</button>

</form>

<div id="confirmation">
  <h2>Děkujeme za objednávku</h2>
  <p>Číslo objednávky: <strong id="confNum"></strong></p>
  <p>Celkem: <strong id="confTotal"></strong> Kč</p>
  <div id="qrcode"></div>
</div>

</main>
</div>

<script>
const prices = { A4:150, A3:250 };

function addItem() {
  const row = document.querySelector('.order-row').cloneNode(true);
  row.querySelectorAll('input').forEach(i=>i.value='');
  row.querySelector('.count').value = 1;
  document.getElementById('items').appendChild(row);
}

function handleSubmit(e) {
  e.preventDefault();

  let summary = '';
  let total = 0;

  document.querySelectorAll('.order-row').forEach((row,i)=>{
    const photo = row.querySelector('.photo').value || '-';
    const format = row.querySelector('.format').value;
    const count = parseInt(row.querySelector('.count').value);
    const price = prices[format] * count;
    total += price;
    summary += `${i+1}. Foto ${photo}, ${format}, ${count} ks = ${price} Kč\n`;
  });

  const orderNumber = Math.floor(10000 + Math.random()*90000);

  document.getElementById('order_number').value = orderNumber;
  document.getElementById('order_items').value = summary;
  document.getElementById('order_total').value = total;

  document.getElementById('confNum').innerText = orderNumber;
  document.getElementById('confTotal').innerText = total;

  document.getElementById('confirmation').style.display = 'block';

  new QRCode(document.getElementById("qrcode"), {
    text: `SPD*1.0*ACC:CZ123456789/0100*AM:${total}*MSG:Objednávka ${orderNumber}`,
    width: 180,
    height: 180
  });

  e.target.submit(); // ⬅️ KRITICKÉ – Netlify TADY bere data
}
</script>

</body>
</html>
