<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Objednávka tisku | Fotograf</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">

<style>
table { width:100%; border-collapse: collapse; margin-top:20px; }
th, td { border-bottom:1px solid #ddd; padding:10px; text-align:left; }
th { background:#f5f5f5; }
button.small { padding:6px 12px; font-size:13px; }
.total { margin-top:20px; font-size:20px; font-weight:600; }
#confirmation { display:none; margin-top:20px; padding:15px; border:1px solid #ccc; border-radius:6px; background:#f9f9f9; }
#qrCode { margin-top:15px; text-align:center; }
#qrCode canvas { display:block; margin:auto; }
.gdpr-consent label a { text-decoration:underline; color:#0073e6; }

/* Sidebar / topbar mobilní */
@media (max-width: 800px) {
    .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 60px;
        padding: 0 15px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        background-color: #E8C098;
        border-bottom: 1px solid #e5e5e5;
        z-index: 1001;
    }
    .sidebar .logo img { width: 40px; height: auto; }
    .sidebar ul { display: none; }
    .hamburger { display: flex; flex-direction: column; cursor: pointer; width: 28px; height: 20px; justify-content: space-between; }
    .hamburger span { display: block; height: 3px; background: #111; border-radius: 3px; }
}
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
<div class="container">

<!-- SIDEBAR / TOPBAR -->
<aside class="sidebar">
    <div class="logo"><a href="index.html"><img src="img/logo.webp" alt="Logo"></a></div>
    <ul>
        <li class="home"><a href="index.html"><svg viewBox="0 0 24 24"><path d="M12 3l9 8h-3v9h-5v-6H11v6H6v-9H3z"/></svg></a></li>
        <li><a href="omne.html">O mně</a></li>
        <li><a href="fotogalerie.html">Fotogalerie</a></li>
        <li><a href="sluzby.html">Služby</a></li>
        <li><a href="tisk.html">Tisk</a></li>
        <li><a href="kontakt.html">Kontakt</a></li>
    </ul>
    <div class="hamburger" id="hamburger"><span></span><span></span><span></span></div>
</aside>

<nav class="mobile-menu" id="mobileMenu">
    <ul>
        <li><a href="index.html">Úvod</a></li>
        <li><a href="omne.html">O mně</a></li>
        <li><a href="fotogalerie.html">Fotogalerie</a></li>
        <li><a href="sluzby.html">Služby</a></li>
        <li><a href="tisk.html">Tisk</a></li>
        <li><a href="kontakt.html">Kontakt</a></li>
    </ul>
</nav>

<main class="content">
<h1>Objednávka tisku fotografií DN</h1>
<p>(V případě zájmu o tisk fotografií mimo DN mě kontaktujte.)</p>

<form name="tisk-form" method="POST" data-netlify="true" netlify-honeypot="bot-field" id="orderForm">
  <input type="hidden" name="form-name" value="tisk-form">
  <p style="display:none"><input name="bot-field"></p>
  <input type="hidden" name="hiddenOrder" id="hiddenOrder">

  <label>Jméno:</label>
  <input type="text" name="jmeno" required>
  <label>Email:</label>
  <input type="email" name="email" required>
  <label>Telefon:</label>
  <input type="tel" name="telefon" required>
  <label>Poznámka:</label>
  <textarea name="poznamka"></textarea>

  <h2>Položky</h2>
  <table id="orderTable">
    <thead>
      <tr>
        <th>Číslo fotky</th>
        <th>Formát</th>
        <th>Počet</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <!-- statický řádek pro Netlify -->
      <tr>
        <td><input type="text" name="cislo[]" required></td>
        <td>
          <select name="format[]">
            <option>10x15 lesk</option>
            <option>10x15 polomat</option>
            <option>13x18 lesk</option>
            <option>13x18 polomat</option>
            <option>A4 lesk</option>
          </select>
        </td>
        <td>
          <select name="pocet[]">
            <option>1</option>
            <option>2</option>
            <option>3</option>
            <option>4</option>
            <option>5</option>
          </select>
        </td>
        <td><button type="button" class="small" onclick="this.closest('tr').remove(); calculate()">✕</button></td>
      </tr>
    </tbody>
  </table>

  <button type="button" onclick="addRow()">+ Přidat položku</button>
  <div class="total">Celková cena: <span id="totalPrice">0</span> Kč</div>

  <div class="gdpr-consent">
    <label>
      <input type="checkbox" name="gdpr_consent" required>
      Souhlasím se zpracováním osobních údajů dle <a href="#gdpr-details" target="_blank">zásad ochrany osobních údajů</a>.
    </label>
    <div id="gdpr-details" style="display:none; margin-top:10px; border:1px solid #ccc; padding:10px;">
      <p>Správcem vašich osobních údajů je <strong>Petr Šapovalov, firma ŠapiFOTO</strong>.</p>
    </div>
  </div>

  <button type="submit" id="submitBtn">Odeslat objednávku</button>
</form>

<div id="confirmation">
  <h2>Objednávka byla odeslána</h2>
  <p>Po zpracování objednávky Vás budu kontaktovat na uvedený email.</p>
  <div id="orderSummary"></div>
  <h3>Údaje pro platbu</h3>
  <p>Číslo účtu: 332726377/0300<br>
     Variabilní symbol (VS): <span id="vs"></span><br>
     Částka k úhradě: <span id="payAmount"></span> Kč
  </p>
  <div id="qrCode"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const prices = {
    "10x15 lesk":10,"10x15 polomat":10,"13x18 lesk":15,"13x18 polomat":15,"A4 lesk":45
  };

  function addRow() {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td><input type="text" name="cislo[]" required></td>
      <td>
        <select name="format[]">
          ${Object.keys(prices).map(f => `<option>${f}</option>`).join('')}
        </select>
      </td>
      <td>
        <select name="pocet[]">
          ${[1,2,3,4,5].map(i=>`<option>${i}</option>`).join('')}
        </select>
      </td>
      <td><button type="button" class="small" onclick="this.closest('tr').remove(); calculate()">✕</button></td>
    `;
    document.querySelector('#orderTable tbody').appendChild(tr);
    tr.querySelectorAll('input, select').forEach(el => el.addEventListener('change', calculate));
    calculate();
  }

  function calculate() {
    let total = 0;
    document.querySelectorAll('#orderTable tbody tr').forEach(row => {
      const format = row.querySelector('select[name="format[]"]').value;
      const count = parseInt(row.querySelector('select[name="pocet[]"]').value);
      total += prices[format]*count;
    });
    document.getElementById('totalPrice').innerText = total;
  }

  addRow();

  const form = document.getElementById('orderForm');
  form.addEventListener('submit', e => {
    e.preventDefault();
    const gdprCheckbox = form.querySelector('input[name="gdpr_consent"]');
    if(!gdprCheckbox.checked){ alert("Musíte souhlasit se zpracováním osobních údajů."); return; }

    let summary = '', total = 0;
    document.querySelectorAll('#orderTable tbody tr').forEach((row,i)=>{
      const num = row.querySelector('input[name="cislo[]"]').value.trim();
      const format = row.querySelector('select[name="format[]"]').value;
      const count = parseInt(row.querySelector('select[name="pocet[]"]').value);
      const price = prices[format]*count;
      total += price;
      summary += `${i+1}. Foto ${num}, ${format}, ks ${count}, cena: ${price} Kč<br>`;
    });

    document.getElementById('hiddenOrder').value = summary + `Celková cena: ${total} Kč`;

    form.style.display = 'none';
    const confirmation = document.getElementById('confirmation');
    confirmation.style.display = 'block';
    document.getElementById('orderSummary').innerHTML = summary;
    document.getElementById('vs').innerText = Math.floor(10000 + Math.random()*90000);
    document.getElementById('payAmount').innerText = total;

    const qrDiv = document.getElementById('qrCode');
    qrDiv.innerHTML = '';
    const iban = "CZ9203000000000332726377";
    const spd = `SPD*1.0*ACC:${iban}*AM:${total}*CC:CZK*MSG:Tisk fotografii*X-VS:${document.getElementById('vs').innerText}`;
    new QRCode(qrDiv,{text:spd,width:300,height:300,colorDark:"#000",colorLight:"#fff",correctLevel:QRCode.CorrectLevel.H});
    
    // Netlify submit
    form.submit();
  });

  // GDPR toggle
  const gdprLink = document.querySelector('.gdpr-consent a');
  const gdprDetails = document.getElementById('gdpr-details');
  if(gdprLink && gdprDetails){
    gdprLink.addEventListener('click', e=>{
      e.preventDefault();
      gdprDetails.style.display = gdprDetails.style.display==='none'?'block':'none';
    });
  }

  // Hamburger menu
  const hamburger = document.getElementById('hamburger');
  const mobileMenu = document.getElementById('mobileMenu');
  hamburger.addEventListener('click', () => { mobileMenu.classList.toggle('active'); });

});
</script>

</main>
</div>
</body>
</html>
