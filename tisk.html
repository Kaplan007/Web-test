<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Objednávka tisku | Fotograf</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">

<style>
table { width:100%; border-collapse: collapse; margin-top:20px; }
th, td { border-bottom:1px solid #ddd; padding:10px; text-align:left; }
th { background:#f5f5f5; }
button.small { padding:6px 12px; font-size:13px; }
.total { margin-top:20px; font-size:20px; font-weight:600; }
#confirmation { display:none; margin-top:20px; padding:15px; border:1px solid #ccc; border-radius:6px; background:#f9f9f9; }
#qrCode { margin-top:15px; text-align:center; }
#qrCode canvas { display:block; margin:auto; }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>

<body>
<div class="container">

<aside class="sidebar">
    <div class="logo">
        <a href="index.html"><img src="img/logo.webp" alt="Logo"></a>
    </div>
    <ul>
        <li class="home"><a href="index.html"><svg viewBox="0 0 24 24"><path d="M12 3l9 8h-3v9h-5v-6H11v6H6v-9H3z"/></svg></a></li>
        <li><a href="omne.html">O mně</a></li>
        <li><a href="fotogalerie.html">Fotogalerie</a></li>
        <li><a href="sluzby.html">Služby</a></li>
        <li><a href="tisk.html">Tisk</a></li>
        <li><a href="kontakt.html">Kontakt</a></li>
    </ul>
    <div class="hamburger" id="hamburger"><span></span><span></span><span></span></div>
</aside>

<nav class="mobile-menu" id="mobileMenu">
    <ul>
        <li><a href="index.html">Úvod</a></li>
        <li><a href="omne.html">O mně</a></li>
        <li><a href="fotogalerie.html">Fotogalerie</a></li>
        <li><a href="sluzby.html">Služby</a></li>
        <li><a href="tisk.html">Tisk</a></li>
        <li><a href="kontakt.html">Kontakt</a></li>
    </ul>
</nav>

<main class="content">
<h1>Objednávka tisku fotografií DN</h1>

<div class="cena-sekce">
  <p><strong>Ceny fotografií dle formátu:</strong></p>
  <table class="ceny">
    <tr><td>10x15 cm</td><td>10 Kč</td></tr>
    <tr><td>13x18 cm</td><td>15 Kč</td></tr>
    <tr><td>21x30 cm (A4)</td><td>45 Kč</td></tr>
  </table>
</div>

<form name="tisk-form" method="POST" data-netlify="true" id="orderForm">
<input type="hidden" name="form-name" value="tisk-form">
<input type="hidden" name="order_summary" id="order_summary">
<input type="hidden" name="order_number" id="order_number">
<input type="hidden" name="total_price" id="total_price">

<label>Jméno:</label>
<input type="text" name="jmeno" required>

<label>Email:</label>
<input type="email" name="email" required>

<label>Telefon:</label>
<input type="tel" name="telefon" required>

<h2>Položky</h2>
<table id="orderTable">
<thead>
<tr>
<th>Číslo fotky</th>
<th>Formát</th>
<th>Počet</th>
<th></th>
</tr>
</thead>
<tbody></tbody>
</table>

<button type="button" id="addItemBtn">+ Přidat položku</button>

<p>Seznam položek:</p>
<div id="summaryByFormat"></div>

<div class="total">
Celková cena: <span id="totalPrice">0</span> Kč
</div>

<label>Poznámka:</label>
<textarea name="poznamka"></textarea><br>
<label class="gdpr">
  <input type="checkbox" name="gdpr" required>
  <span>Souhlasím se <a href="gdpr.html" target="new">zpracováním osobních údajů</a></span>
</label>

<br>
<button type="submit" id="submitBtn">Odeslat objednávku</button>
</form>

<div id="confirmation">
<h2>Objednávka byla odeslána</h2>
<p>Číslo objednávky: <strong><span id="confOrderNum"></span></strong></p>
<div id="confSummary"></div>

<h3>Údaje pro platbu</h3>
<p>
Číslo účtu: 332726377/0300<br>
Variabilní symbol: <span id="confVS"></span><br>
Částka: <span id="confAmount"></span> Kč
</p>
<div id="qrCode"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

const prices = {
  "10x15 lesk":10,
  "10x15 polomat":10,
  "13x18 lesk":15,
  "13x18 polomat":15,
  "A4 lesk":45,
  "A4 polomat":45
};

const tbody = document.querySelector('#orderTable tbody');
const summaryDiv = document.getElementById('summaryByFormat');
const totalPriceEl = document.getElementById('totalPrice');

// Přidání nové položky
function addRow() {
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td><input type="text" class="num" required></td>
    <td><select class="format">${Object.keys(prices).map(f=>`<option>${f}</option>`).join('')}</select></td>
    <td><select class="count">${[...Array(10)].map((_,i)=>`<option>${i+1}</option>`).join('')}</select></td>
    <td><button type="button" class="small">✕</button></td>
  `;
  tr.querySelector('button').onclick = () => { tr.remove(); calculate(); };
  tr.querySelectorAll('input,select').forEach(el => el.onchange = calculate);
  tbody.appendChild(tr);
  calculate();
}

document.getElementById('addItemBtn').onclick = addRow;
addRow();

// Výpočet celkové ceny a souhrnu
function calculate() {
  let total = 0;
  let summary = {};
  tbody.querySelectorAll('tr').forEach(row => {
    const f = row.querySelector('.format').value;
    const c = parseInt(row.querySelector('.count').value);
    const p = prices[f] * c;
    total += p;
    summary[f] = summary[f] ? {count:summary[f].count+c, price:summary[f].price+p} : {count:c, price:p};
  });
  summaryDiv.innerHTML = Object.keys(summary).map(f => `${f} – ${summary[f].count} ks (${summary[f].price} Kč)`).join('<br>');
  totalPriceEl.innerText = total;
}

// Submit handler
document.getElementById('orderForm').addEventListener('submit', e => {
  e.preventDefault();

  // Vytvoření souhrnu položek
  let summaryText = '';
  tbody.querySelectorAll('tr').forEach((row,i)=>{
    summaryText += `${i+1}. ${row.querySelector('.num').value} / ${row.querySelector('.format').value} / ${row.querySelector('.count').value} ks\n`;
  });

  const total = totalPriceEl.innerText;
  const vs = Math.floor(10000 + Math.random()*90000);

  document.getElementById('order_summary').value = summaryText;
  document.getElementById('order_number').value = vs;
  document.getElementById('total_price').value = total;

  const formData = new FormData(e.target); // <-- důležité!

  // Odeslání do Google Scriptu
  fetch('https://script.google.com/macros/s/AKfycbzP5ID3j0Tmesovdu057cae961VL0AC8Y585kBUqX4g-JDpX9rs-DmOVR3Jix3W6HA/exec', {
    method:'POST',
    body: formData
  });

  // Odeslání do Netlify
  fetch('/', {
    method: 'POST',
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: new URLSearchParams(formData).toString()
  });

  // Zobrazení potvrzení
  document.getElementById('orderForm').style.display='none';
  document.getElementById('confirmation').style.display='block';
  document.getElementById('confOrderNum').innerText = vs;
  document.getElementById('confSummary').innerText = summaryText;
  document.getElementById('confVS').innerText = vs;
  document.getElementById('confAmount').innerText = total;

  new QRCode(document.getElementById('qrCode'), {
    text:`SPD*1.0*ACC:CZ9203000000000332726377*AM:${total}*CC:CZK*X-VS:${vs}`,
    width:280, height:280
  });
});

// Hamburger menu
document.getElementById('hamburger').onclick = () =>
  document.getElementById('mobileMenu').classList.toggle('active');

});
</script>
</main>
</div>
</body>
</html>