<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Objednávka tisku | Fotograf</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
/* Tabulka a formulář */
table { width:100%; border-collapse: collapse; margin-top:20px; }
th, td { border-bottom:1px solid #ddd; padding:10px; text-align:left; }
th { background:#f5f5f5; }
button.small { padding:6px 12px; font-size:13px; }
.total { margin-top:20px; font-size:20px; font-weight:600; }
#confirmation { display:none; margin-top:20px; padding:15px; border:1px solid #ccc; border-radius:6px; background:#f9f9f9; }
#qrCode { margin-top:15px; text-align:center; }
#qrCode canvas { display:block; margin:auto; }
.gdpr-consent label a { text-decoration:underline; color:#0073e6; }
</style>
</head>
<body>
<div class="container">

<aside class="sidebar">
  <div class="logo"><a href="index.html"><img src="img/logo.webp" alt="Logo"></a></div>
  <ul>
    <li class="home"><a href="index.html"><svg viewBox="0 0 24 24"><path d="M12 3l9 8h-3v9h-5v-6H11v6H6v-9H3z"/></svg></a></li>
    <li><a href="omne.html">O mně</a></li>
    <li><a href="fotogalerie.html">Fotogalerie</a></li>
    <li><a href="sluzby.html">Služby</a></li>
    <li><a href="tisk.html">Tisk</a></li>
    <li><a href="kontakt.html">Kontakt</a></li>
  </ul>
  <div class="hamburger" id="hamburger"><span></span><span></span><span></span></div>
</aside>

<nav class="mobile-menu" id="mobileMenu">
  <ul>
    <li><a href="index.html">Úvod</a></li>
    <li><a href="omne.html">O mně</a></li>
    <li><a href="fotogalerie.html">Fotogalerie</a></li>
    <li><a href="sluzby.html">Služby</a></li>
    <li><a href="tisk.html">Tisk</a></li>
    <li><a href="kontakt.html">Kontakt</a></li>
  </ul>
</nav>

<main class="content">
<h1>Objednávka tisku fotografií DN</h1>
<p>(V případě zájmu o tisk fotografií mimo DN mě kontaktujte.)</p>

<form name="tisk" netlify netlify-honeypot="bot-field" id="orderForm">
  <input type="hidden" name="form-name" value="tisk">
  <p style="display:none"><input name="bot-field"></p>

  <label>Jméno: <input type="text" name="jmeno" required></label>
  <label>Email: <input type="email" name="email" required></label>
  <label>Telefon: <input type="tel" name="telefon" required></label>

  <h2>Položky</h2>
  <p>Číslo fotografie je posledních 5 číslic z názvu souboru.</p>
  <table id="orderTable">
    <thead>
      <tr><th>Číslo fotky</th><th>Formát</th><th>Počet</th><th></th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <button type="button" id="addItemBtn">+ Přidat položku</button>

  <div class="gdpr-consent">
    <label><input type="checkbox" name="gdpr_consent" required> Souhlasím se zpracováním osobních údajů dle <a href="#gdpr-details">zásad ochrany osobních údajů</a>.</label>
    <div id="gdpr-details" style="display:none;">
      <p>Správcem vašich osobních údajů je Petr Šapovalov, firma ŠapiFOTO.</p>
    </div>
  </div>

  <label>Poznámka: <textarea name="poznamka"></textarea></label>
  <div class="total">Celková cena: <span id="totalPrice">0</span> Kč</div>

  <button type="submit" id="submitBtn">Odeslat objednávku</button>
</form>

<div id="confirmation">
  <h2>Objednávka byla odeslána</h2>
  <p>Číslo objednávky: <span id="orderNumber"></span></p>
  <div id="orderSummary"></div>
  <h3>Údaje pro platbu</h3>
  <p>Číslo účtu: 332726377/0300<br>
  Variabilní symbol (VS): <span id="vs"></span><br>
  Částka k úhradě: <span id="payAmount"></span> Kč</p>
  <div id="qrCode"></div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

const prices = {
    "10x15 lesk":10, "10x15 polomat":10,
    "13x18 lesk":15, "13x18 polomat":15,
    "A4 lesk":45, "A4 polomat":45
};

// Přidat položku
function addRow() {
  const tr = document.createElement('tr');
  tr.innerHTML = `
    <td><input type="text" class="num" name="cislo[]" required></td>
    <td><select class="format" name="format[]">${Object.keys(prices).map(f=>`<option>${f}</option>`).join('')}</select></td>
    <td><select class="count" name="pocet[]">${[...Array(10)].map((_,i)=>`<option>${i+1}</option>`).join('')}</select></td>
    <td><button type="button" class="small">✕</button></td>
  `;
  document.querySelector('#orderTable tbody').appendChild(tr);
  tr.querySelector('button').addEventListener('click', ()=>{
    tr.remove();
    calculate();
  });
  tr.querySelectorAll('input, select').forEach(el=>el.addEventListener('change', calculate));
  calculate();
}

document.getElementById('addItemBtn').addEventListener('click', addRow);
addRow(); // defaultně jedna položka

// Spočítat celkovou cenu
function calculate() {
  let total = 0;
  const summary = {};
  document.querySelectorAll('#orderTable tbody tr').forEach(row=>{
    const format = row.querySelector('.format').value;
    const count = parseInt(row.querySelector('.count').value);
    total += prices[format]*count;
  });
  document.getElementById('totalPrice').innerText = total;
}

// Odeslání formuláře a zobrazení potvrzení
const form = document.getElementById('orderForm');
form.addEventListener('submit', e=>{
  e.preventDefault(); // pro QR + potvrzení
  const gdpr = form.querySelector('input[name="gdpr_consent"]');
  if(!gdpr.checked){ alert("Musíte souhlasit."); return; }

  let total = 0, summary='';
  document.querySelectorAll('#orderTable tbody tr').forEach((row,i)=>{
    const num = row.querySelector('.num').value.trim();
    const format = row.querySelector('.format').value;
    const count = parseInt(row.querySelector('.count').value);
    const price = prices[format]*count;
    total += price;
    summary += `${i+1}. Foto ${num}, ${format}, ks ${count}, cena: ${price} Kč<br>`;
  });

  const vs = Math.floor(10000 + Math.random()*90000);
  const orderNum = Math.floor(10000 + Math.random()*90000);

  form.style.display='none';
  const conf = document.getElementById('confirmation');
  conf.style.display='block';
  document.getElementById('orderSummary').innerHTML = summary;
  document.getElementById('vs').innerText = vs;
  document.getElementById('payAmount').innerText = total;
  document.getElementById('orderNumber').innerText = orderNum;

  const qrDiv = document.getElementById('qrCode');
  qrDiv.innerHTML='';
  const iban = "CZ9203000000000332726377";
  const spd = `SPD*1.0*ACC:${iban}*AM:${total.toFixed(2)}*CC:CZK*MSG:Tisk fotografii*X-VS:${vs}`;
  new QRCode(qrDiv,{text:spd,width:200,height:200});

  // Netlify submit
  const formData = new FormData(form);
  fetch('/', {method:'POST', body: formData})
    .then(()=>console.log('Odesláno na Netlify'))
    .catch(err=>alert(err));
});

// GDPR toggle
document.querySelector('.gdpr-consent a').addEventListener('click', e=>{
  e.preventDefault();
  const details=document.getElementById('gdpr-details');
  details.style.display = details.style.display==='none'?'block':'none';
});

// Hamburger
const hamburger = document.getElementById('hamburger');
const mobileMenu = document.getElementById('mobileMenu');
hamburger.addEventListener('click', ()=> mobileMenu.classList.toggle('active'));

});
</script>
</div>
</body>
</html>
